<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Portfolio</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .form-container {
            margin: 20px 0;
        }
        .form-container input[type="number"], .form-container input[type="text"], .form-container select {
            width: calc(100% - 20px);
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .form-container button {
            padding: 10px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .form-container button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>User Portfolio</h1>
    <table>
        <thead>
            <tr>
                <th>Ticker Symbol</th>
                <th>Shares Owned</th>
                <th>Open Price</th>
                <th>Close Price</th>
                <th>Difference</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody id="portfolio">
        </tbody>
    </table>

    <div class="form-container">
        <button onclick="window.location.href='addStock.html';">Add Stock to Portfolio</button>
        <button onclick="window.location.href='stonks.html';">View All Stocks</button>
    </div>

    <script>
    async function displayPortfolio(userId) {
        try {
            // Fetch the portfolio data
            const portfolioResponse = await fetch(`/portfolio/${userId}`);
            if (!portfolioResponse.ok) {
                throw new Error(`HTTP error! status: ${portfolioResponse.status}`);
            }
            const portfolio = await portfolioResponse.json();
            console.log('Portfolio data:', portfolio); // Log fetched portfolio data

            // Fetch the stock data
            const stockData = {};
            for (const entry of portfolio) {
                const stockResponse = await fetch(`/stock/${entry.StockID}`);
                if (!stockResponse.ok) {
                    throw new Error(`HTTP error! status: ${stockResponse.status}`);
                }
                stockData[entry.StockID] = await stockResponse.json();
                console.log('Fetched stock data for StockID:', entry.StockID, stockData[entry.StockID]); // Debug log
            }

            const portfolioTable = document.getElementById('portfolio');
            portfolioTable.innerHTML = ''; // Clear previous content

            portfolio.forEach(entry => {
                const stock = stockData[entry.StockID];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${stock.TickerSymbol}</td>
                    <td>${entry.SharesOwned}</td>
                    <td>$${stock.openPrice.toFixed(2)}</td>
                    <td>$${stock.closePrice.toFixed(2)}</td>
                    <td>${stock.Difference}</td>
                    <td>${stock.Date}</td>
                `;
                portfolioTable.appendChild(row);
            });
        } catch (error) {
            console.error('Error fetching portfolio:', error);
        }
    }

    // Call this function with the logged-in user's ID
    displayPortfolio(1); // Replace with the actual UserID
    </script>
</body>
</html>